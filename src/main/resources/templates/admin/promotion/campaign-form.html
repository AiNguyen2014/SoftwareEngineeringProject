<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title th:text="${pageTitle}">Chiến dịch</title>
    <link rel="stylesheet" th:href="@{/css/admin.css}">
    <link rel="stylesheet" th:href="@{/css/common.css}">
</head>
<body>
<!-- Loading Overlay -->
<div class="loading-overlay" id="loadingOverlay">
    <div class="spinner"></div>
</div>

<div class="admin-layout">
    <aside class="sidebar">
        <div th:replace="~{admin/sidebar :: sidebar}"></div>
    </aside>
    <div class="main">
        <header class="topbar">
            <div class="topbar-inner">
                <div class="topbar-left">
                    <button class="menu-toggle" aria-label="Toggle menu">☰</button>
                    <h3 th:text="${pageTitle}">Chiến dịch</h3>
                </div>
            </div>
        </header>
        <main class="page-content">
            <div th:if="${error}" class="alert alert-error" th:text="${error}"></div>

            <div class="card" style="max-width: 900px;">
                <div style="margin-bottom: 24px;">
                    <h3 class="section-title" th:text="${pageTitle}">Tạo chiến dịch</h3>
                    <p class="section-sub">Điền đầy đủ thông tin chiến dịch để áp dụng giảm giá cho khách hàng.</p>
                </div>
                <form th:action="${campaign.campaignId} == null ? @{/admin/promotions/campaigns/create} : @{'/admin/promotions/campaigns/' + ${campaign.campaignId} + '/edit'}" method="post" th:object="${campaign}">
                    <div class="form-row">
                        <div class="form-group">
                            <label class="required">Tên chiến dịch</label>
                            <input type="text" th:field="*{name}" required placeholder="VD: Giảm giá cuối năm">
                            <small style="color: #6b7280; font-size: 12px;">Tên hiển thị của chiến dịch khuyến mãi</small>
                            <div class="error-message" th:if="${#fields.hasErrors('name')}" th:errors="*{name}"></div>
                        </div>
                        <div class="form-group">
                            <label>Trạng thái</label>
                            <input type="text" th:value="${campaign.status != null ? campaign.status : 'AUTO'}" disabled style="background: #f3f4f6; color: #6b7280;">
                            <small style="color: #6b7280; font-size: 12px;">Trạng thái tự động cập nhật theo ngày</small>
                        </div>
                    </div>

                    <div class="form-group full-width">
                        <label>Mô tả</label>
                        <textarea th:field="*{description}" rows="3" placeholder="Mô tả chi tiết về chiến dịch..."></textarea>
                        <small style="color: #6b7280; font-size: 12px;">Thông tin bổ sung về chiến dịch (không bắt buộc)</small>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="required">Ngày bắt đầu</label>
                            <input type="date" name="startDate" 
                                   th:value="${campaign.startDate != null ? campaign.startDate : ''}"
                                   required>
                            <small style="color: #6b7280; font-size: 12px;">Ngày bắt đầu áp dụng chiến dịch</small>
                            <div class="error-message" th:if="${#fields.hasErrors('startDate')}" th:errors="*{startDate}"></div>
                        </div>
                        <div class="form-group">
                            <label class="required">Ngày kết thúc</label>
                            <input type="date" name="endDate"
                                   th:value="${campaign.endDate != null ? campaign.endDate : ''}"
                                   required>
                            <small style="color: #6b7280; font-size: 12px;">Ngày kết thúc chiến dịch</small>
                            <div class="error-message" th:if="${#fields.hasErrors('endDate')}" th:errors="*{endDate}"></div>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="required">Loại giảm</label>
                            <select th:field="*{discountType}" required>
                                <option value="">-- Chọn loại giảm --</option>
                                <option th:each="t : ${discountTypes}" th:value="${t}" th:text="${t}"></option>
                            </select>
                            <small style="color: #6b7280; font-size: 12px;">PERCENT (%) hoặc FIXED (VNĐ)</small>
                            <div class="error-message" th:if="${#fields.hasErrors('discountType')}" th:errors="*{discountType}"></div>
                        </div>
                        <div class="form-group">
                            <label class="required">Giá trị giảm</label>
                            <input type="number" step="1" min="0" th:field="*{discountValue}" required placeholder="VD: 10 hoặc 100000">
                            <small style="color: #6b7280; font-size: 12px;">Nếu % thì nhập 10, nếu VNĐ thì nhập 100000</small>
                            <div class="error-message" th:if="${#fields.hasErrors('discountValue')}" th:errors="*{discountValue}"></div>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Mức giảm tối đa</label>
                            <input type="number" step="1000" min="0" th:field="*{maxDiscountAmount}" placeholder="VD: 100000">
                            <small style="color: #6b7280; font-size: 12px;">Giới hạn số tiền giảm (không bắt buộc)</small>
                        </div>
                        <div class="form-group">
                            <label>Giá trị đơn hàng tối thiểu</label>
                            <input type="number" step="1000" min="0" th:field="*{minOrderValue}" placeholder="VD: 500000">
                            <small style="color: #6b7280; font-size: 12px;">Đơn hàng tối thiểu để áp dụng (không bắt buộc)</small>
                        </div>
                    </div>

                    <div style="margin-top: 24px; padding-top: 24px; border-top: 1px solid #e5e7eb;">
                        <div class="form-group" style="display:flex; align-items:center; gap:12px;">
                            <label style="margin:0; font-weight: 600;">Kích hoạt chiến dịch</label>
                            <label class="toggle-switch">
                                <input type="checkbox" th:field="*{enabled}">
                                <span class="toggle-slider"></span>
                            </label>
                            <small style="color: #6b7280; font-size: 12px; margin-left: 8px;">Bật/tắt chiến dịch ngay lập tức</small>
                        </div>
                    </div>

                    <div class="form-actions" style="margin-top: 32px; padding-top: 24px; border-top: 1px solid #e5e7eb; display: flex; gap: 12px;">
                        <button type="submit" class="btn btn-primary" style="padding: 10px 24px;">
                            Lưu chiến dịch
                        </button>
                        <a th:href="@{/admin/promotions/campaigns}" class="btn btn-secondary" style="padding: 10px 24px;">
                            Hủy bỏ
                        </a>
                    </div>
                </form>
            </div>
        </main>
    </div>
</div>
<script>
    document.addEventListener('click', function (e) {
        if (!e.target.matches('.menu-toggle')) return;
        const sidebar = document.querySelector('.sidebar');
        if (sidebar) sidebar.classList.toggle('collapsed');
    });
    
    // Loading indicator for form submission
    document.querySelector('form').addEventListener('submit', function(e) {
        const overlay = document.getElementById('loadingOverlay');
        if (overlay) {
            overlay.classList.add('show');
        }
    });
</script>
</body>
</html>
