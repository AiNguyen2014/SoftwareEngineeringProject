@startuml ViewShoeList_Sequence
!theme plain

title View Shoe List

actor "Registered Customer\nUnregistered Customer" as user
participant "ShoeListUI" as ui
participant "ShoesController" as controller
participant "ShoesService" as service
participant "ShoesRepository" as repo
database "Database" as db

== View Shoe List ==

user -> ui: Truy cập trang chủ
activate ui

ui -> controller: Yêu cầu lấy trang 1 (page=1)
activate controller

controller -> service: getShoesList(page, size)
activate service

service -> repo: findAllPaged(pageable)
activate repo
repo -> db: Truy vấn các sản phẩm đang hiển thị (Select Active Shoes)
db --> repo: Kết quả (ResultSet)
deactivate repo

repo --> service: Danh sách (Page<Shoes>)

service -> repo: findAllByIdsWithImages(shoeIds)
activate repo
repo -> db: SELECT ... LEFT JOIN FETCH images
db --> repo: List<Shoes> with images
deactivate repo

loop Mỗi đôi giày trên trang
    service -> service: Ghép dữ liệu & Kiểm tra trạng thái\nMap DTO + Check New/Stock
end

service --> controller: Dữ liệu hiển thị (ShoesListDto)
deactivate service

controller -> ui: Truyền dữ liệu (model.addAttribute)

ui --> user: Display filtered/sorted shoes
deactivate controller

ui --> user: Hiển thị giao diện danh sách

opt Customer nhấn vào giày
    user -> ui: Select a shoe to view details
    ref over user, db: View Shoe Detail
end

deactivate ui

@enduml
